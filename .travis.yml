language: go
sudo: required
services:
- docker
notifications:
  email: true
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: WGoZkLHOIGVc4Twiiwyi0P0JweWAldIefK46+6Al1qdLOvNNDYzKYMCZprgRPMIW9L6tSdzjYfD9R5NA7p8NRtDLaOFaZTj3mjGQ6aA3auxTFOL3hjTCmIZ7ObXHLaFL4vWifey2BZUSjXVYiExIE+we8s99YILawx2BzdYO4pYw2hmPVZYJr9wut+60v4pBOgmiViofH/2nDFIqrPCAMvrvzCYyMHtAIQxOmZv5Az/J+GxuaWru3KGfPbPsbYPgVkT5LXwTyUpkq2SozK1ciGpeNMGXDSw329wtHY0ROPY1tfFRKaMeWW/rsPyrGLkYxyq+RnzyOnRWy5C4CBAjVgNtNZewGlLy3sLeHaCm4+1ytyuNabMWi2WZ4x5brAmpRriZuIy/d1KCRRuW5Idwa36tRh/Dj8+0sVqRGMWI4Zlqmesmqs9w+3MovaGqudpQV1CZmWuV0ElgZm0C1G6/7bWW8wYJpmAFAKEXL8IN2pcGwR6Rdw5DcN9dMiFytcI6FjMF2lI3ZYRrPeSx6MmRNndAmj4ByxFr7Iz+Cwmj5/p4H8d0QqnMcxflPno10g0ro0wJF0O7I6He6wYa3YHDKE+A7cVaJVikQ/Zvv8WLR2vmDYO33PjjVeaV+w3pC4tpTWLFccGglIPYmw7PEVeoRCARhkIToYDp6zoWIzrfRqI=
  - secure: iyfdC+SOMYJ39ZACaTWogsTVBMjxjNIFpkP1jmUVFwVl9y7SRWWjz+aS0H6SQOVeBcMW2OFuO5v0j/uUbgYuM2HES3QN8gAnc/7h/d4qysVIMXvHHfrky9XhhXoN+fxr77OE3NrSHi+JRfvWE9frZyjNJg7DeaOSzWmjxticg9/0msNS41gJaB7dnIFHAiV4YrqQkkUa6hVx1VLUEuRYmVyuaFL0etCT4fkCFiNbEF6Xwa4M8vwdtdtv28LcVHYlySMU1jJU1mtV3HyDnKIxBU8VupFkYclogk3xRuT6oEr8ajxSW1pckpbDxrniLXftPmn3briJxWDDd+8vaJAJupN9+gs+rCGtgeDUf+PhhmJ/ZEiLn8I1rE41sEU46xr1T76lkIHhWRGpJHfGQ2qpfTaO9sMmaw2/16S6iVu2i7hHJPCiaWAN/8uynMEFdw+4BwrHovHf9IEoPsK810aDh+AOPO5cXYWOUrtAaz7GZiuTTV6fLV0H7Zq45qtae7edgPpCn0RF7vnVNPvVxdlmdQalCNGni2GIfwXcXXYy2Vf5buh41GWdbRvUxotNtYDmVTlNF4KEnE1DsSKTfZYFUvD1Oz6RXkzrtM7tPgjEqMShf+sIxbENxdTCHRk6RcvZevNJnpyoLqB5nBQo94oleUC8cX3BeVl1jGE/5AR1pFc=
go:
- 1.7.4
install:
- go get github.com/golang/lint/golint
script:
- go build -v
- go vet $(go list ./... | grep -v vendor)
- test -z "$(golint ./... | grep -v vendor | tee /dev/stderr)"
- test -z "$(gofmt -s -l . | grep -v vendor | tee /dev/stderr)"
- make release
after_success:
- docker login -u $DOCKER_USER -p "$DOCKER_PASS"
- export REPO=smalldave/weather
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH
  ; fi`
- docker build -f Dockerfile -t $REPO:$COMMIT .
- docker tag $REPO:$COMMIT $REPO:$TAG
- docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
- docker push $REPO
